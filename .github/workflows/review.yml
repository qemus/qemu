on:
  pull_request:

name: "Review"

permissions:
  contents: read
  pull-requests: write
  checks: write

jobs:
  review:
    name: review
    runs-on: ubuntu-latest
    steps:
      - 
        name: Get User Permission
        id: checkAccess
        uses: actions-cool/check-user-permission@v2
        with:
          require: write
          username: ${{ github.triggering_actor }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - 
        name: Check User Permission
        if: steps.checkAccess.outputs.require-result == 'false'
        run: |
          echo "${{ github.triggering_actor }} does not have permissions on this repo."
          echo "Current permission level is ${{ steps.checkAccess.outputs.user-permission }}"
          echo "Job originally triggered by ${{ github.actor }}"
      - 
        name: Checkout code
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: actions/checkout@v5
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      - 
        name: Spelling
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-misspell@v1
        with:
          locale: "US"
          level: warning
          pattern: |
            *.md
            *.sh
          reporter: github-pr-review
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
      -
        name: Hadolint
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-hadolint@v1
        with:
          level: warning
          reporter: github-pr-review
          hadolint_ignore: DL3003 DL3006 DL3008
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
      -
        name: YamlLint
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-yamllint@v1
        with:
          level: warning
          reporter: github-pr-review
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
      -
        name: ActionLint
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-actionlint@v1
        with:
          level: warning
          reporter: github-pr-review
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
      -
        name: Shellformat
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-shfmt@v1
        with:
          level: warning
          shfmt_flags: "-i 2 -ci -bn"
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
      -
        name: Shellcheck
        if: steps.checkAccess.outputs.require-result == 'true'
        uses: reviewdog/action-shellcheck@v1
        with:
          level: warning
          reporter: github-pr-review
          shellcheck_flags: -x -e SC2001 -e SC2034 -e SC2064 -e SC2317 -e SC2153
          github_token: ${{ secrets.REPO_ACCESS_TOKEN }}
